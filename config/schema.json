{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/yourname/jiujiu-plugin/schema.json",
  "title": "jiujiu-plugin 配置规范",
  "description": "基于 assets 目录结构的配置校验规则",
  "type": "object",
  "additionalProperties": false,
  "required": ["core", "image", "commands"],
  "definitions": {
    "sizeString": {
      "type": "string",
      "pattern": "^\\d+(\\.\\d+)?[KMG]?B$",
      "examples": ["500KB", "10MB", "1.5GB"],
      "description": "支持 B/KB/MB/GB 单位的大小表示"
    },
    "assetPath": {
      "type": "string",
      "pattern": "^(\./assets/|/|[A-Za-z]:\\\\|\\w+:)",
      "examples": ["./assets/images", "/mnt/data/images", "C:\\pics"],
      "description": "必须指向 assets 目录或绝对路径"
    },
    "durationString": {
      "type": "string",
      "pattern": "^\\d+[smh]$",
      "examples": ["30s", "5m", "2h"],
      "description": "时间间隔（秒/分钟/小时）"
    }
  },
  "properties": {
    "core": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "debug": {
          "type": "boolean",
          "default": false,
          "description": "调试模式（输出详细日志）"
        },
        "logLevel": {
          "type": "string",
          "enum": ["error", "warn", "info", "debug", "silly"],
          "default": "info",
          "description": "日志输出级别"
        },
        "dataPath": {
          "$ref": "#/definitions/assetPath",
          "default": "./data/jiujiu",
          "description": "插件数据存储根目录"
        },
        "performance": {
          "type": "object",
          "properties": {
            "gcInterval": {
              "type": "integer",
              "minimum": 10,
              "default": 3600,
              "description": "内存回收间隔（秒）"
            },
            "maxMemory": {
              "$ref": "#/definitions/sizeString",
              "default": "512MB",
              "description": "插件最大内存占用"
            }
          }
        }
      },
      "required": ["logLevel", "dataPath"]
    },
    "image": {
      "type": "object",
      "additionalProperties": false,
      "required": ["local", "web"],
      "properties": {
        "local": {
          "type": "object",
          "properties": {
            "path": {
              "$ref": "#/definitions/assetPath",
              "default": "./assets/images",
              "description": "本地图片存储路径"
            },
            "maxSize": {
              "$ref": "#/definitions/sizeString",
              "default": "20MB",
              "description": "单张图片大小上限"
            },
            "allowedExtensions": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^\\.[a-zA-Z0-9]+$"
              },
              "default": [".jpg", ".jpeg", ".png", ".webp"],
              "description": "允许的图片格式"
            },
            "scanInterval": {
              "type": "integer",
              "minimum": 10,
              "default": 300,
              "description": "目录扫描间隔（秒）"
            }
          },
          "required": ["path", "maxSize"]
        },
        "web": {
          "type": "object",
          "properties": {
            "apis": {
              "type": "array",
              "minItems": 1,
              "items": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "format": "uri",
                    "description": "图片API地址"
                  },
                  "weight": {
                    "type": "integer",
                    "minimum": 1,
                    "default": 1,
                    "description": "权重值（越高越优先）"
                  }
                },
                "required": ["url"]
              }
            },
            "timeout": {
              "type": "integer",
              "minimum": 1000,
              "default": 8000,
              "description": "请求超时时间（毫秒）"
            }
          },
          "required": ["apis"]
        }
      }
    },
    "commands": {
      "type": "object",
      "properties": {
        "prefix": {
          "type": "string",
          "minLength": 1,
          "maxLength": 3,
          "default": "#",
          "description": "触发指令前缀"
        },
        "cooldown": {
          "type": "object",
          "properties": {
            "global": {
              "type": "integer",
              "minimum": 0,
              "default": 1000,
              "description": "全局冷却时间（毫秒）"
            },
            "specific": {
              "type": "object",
              "patternProperties": {
                "^\\w+$": {
                  "type": "integer",
                  "minimum": 0
                }
              },
              "description": "特定命令冷却时间"
            }
          }
        }
      },
      "required": ["prefix"]
    }
  }
}
{
  "definitions": {
    "dbPath": {
      "type": "string",
      "pattern": "^(\./database/(db-migrations|models)|/)",
      "examples": [
        "./database/db-migrations",
        "./database/models"
      ]
    }
  },
  "properties": {
    "database": {
      "properties": {
        "migrationsPath": {
          "$ref": "#/definitions/dbPath",
          "default": "./database/db-migrations"
        }
      }
    }
  }
}